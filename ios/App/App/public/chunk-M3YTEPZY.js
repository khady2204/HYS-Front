import{b as l,c as u}from"./chunk-RETT3Y54.js";import{M as m,Q as h,o}from"./chunk-WVCMXTPH.js";import{a as n}from"./chunk-JHI3MBHO.js";var b=(()=>{let s=class s{constructor(e){this.http=e,this.baseUrl="http://localhost:8081/api/messages"}sendMessage(e){return this.http.post(`${this.baseUrl}`,e).pipe(o(t=>this.mapMessage(t)))}getMessageWithUser(e,t){return this.http.get(`${this.baseUrl}/${e}`).pipe(o(i=>i.map(r=>this.mapMessage(r,t))))}getAllDiscussions(e){return this.http.get(`${this.baseUrl}/discussions`).pipe(o(t=>t.map(i=>({ami:{id:i.ami.id,prenom:i.ami.prenom,nom:i.ami.nom,profileImage:i.ami.profileImage||i.ami.profile_image,phone:i.ami.phone},messages:i.messages.map(r=>this.mapMessage(r,e)),unreadCount:i.unreadCount}))))}markMessageAsRead(e){return this.http.put(`${this.baseUrl}/${e}/read`,{})}searchDiscussion(e,t){let i=new l({fromObject:n(n(n({},e.phone&&{phone:e.phone}),e.nom&&{nom:e.nom}),e.prenom&&{prenom:e.prenom})});return this.http.get(`${this.baseUrl}/discussions/search`,{params:i}).pipe(o(r=>r.map(a=>({ami:{id:a.ami.id,prenom:a.ami.prenom,nom:a.ami.nom,profileImage:a.ami.profileImage||a.ami.profile_image,phone:a.ami.phone},messages:a.messages.map(c=>this.mapMessage(c,t)),unreadCount:a.unreadCount}))))}mapMessage(e,t){let i=e.senderId??e.sender_id,r=e.receiverId??e.receiver_id;return{id:e.id,senderId:i,receiverId:r,content:e.content??"",timestamp:e.timestamp,read:e.read??!1,mediaUrl:e.mediaUrl??e.media_url??null,mediaType:e.mediaType??e.media_type??null,audioDuration:e.audioDuration??e.audio_duration??0,isSender:t!=null?i===t:!1}}};s.\u0275fac=function(t){return new(t||s)(h(u))},s.\u0275prov=m({token:s,factory:s.\u0275fac,providedIn:"root"});let p=s;return p})();export{b as a};
